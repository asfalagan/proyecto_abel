
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/a5191f3c7b.js" crossorigin="anonymous"></script>
    <script src="./js/jwt.js"></script>
    <title>Document</title>
    <style>
      .active > .page-link{
        background-color: #f8f9fa !important;
        color: #2b3035 !important;
        border-color: #f8f9fa !important;
        font-weight: bold;
      }
        .card{
          opacity: 0.8 !important;
        }
        .hidden{
            display: none !important;
        }
        #capaOpaca {
            opacity: 0.60;
            z-index: -100;
            width: 100vw;
            height: 100vh;
            position: fixed;
            background-color: black;
        }
        body{
            background-image: url("./images/bck576.jpg");
            background-color: black;
            /* background-position: center 5vh; */
            background-repeat: no-repeat;
            background-size: cover;
            height: 100%;
            width: 100vw;
            background-attachment: fixed;
        }
        .contenidoCentrado{
            display: flex;
            justify-content: center;
            align-items:flex-end;
        }
        * {
          color: #f8f9fa !important;
        }
        .redondeada{
        border-radius: 1em;
        }
        .pointer{
          cursor: pointer;
        }
        .sombra{
            box-shadow: 0 1px 3px 0 rgba(248, 249, 250,0.2), 0 1px 3px -1px rgba(248, 249, 250,0.2);
        }
        /**ESTILOS PANTALLA SMALL**/
        @media (min-width: 576px){
          body{
              background-image: url("./images/bck576.jpg");
          }
          .card{
            opacity: 0.8 !important;
          }
          .card:hover{
            opacity: 1 !important;
          }
        }
        /**ESTILOS PANTALLA MD**/
        @media (min-width: 768px){
            body{
                background-image: url("./images/bck768.jpg");
            }
        }
      /**ESTILOS PANTALLA GRANDE**/
        @media (min-width: 992px){
          body{
              background-image: url("./images/bck992.jpg");
          }
        }
      /**ESTILOS PANTALLA XGRANDE**/
      @media (min-width: 1200px){
          body{
              background-image: url("./images/bck1200.jpg");
          }
        }
      /**ESTILOS PANTALLA XXGRANDE**/
      @media (min-width: 1400px){
          body{
              background-image: url("./images/bck1920.jpg");
          }
        }
    </style>
</head>
<body  data-bs-theme="dark">
    <div id="capaOpaca"></div>
  
    <nav class="navbar navbar-expand-lg  bg-dark">
        <div class="container-fluid ms-3  me-5">
          <a class="navbar-brand" href="#">
            <i class="fa-solid fa-person-running"></i>
            <span>RaceBook</span>
          </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="#">Catálogo de Carreras</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" id="enlaceCuenta">Cuenta de Usuario</a>
              </li>
            </ul>
        
            
          </div>
        </div>
    </nav>
    <main class="container-fluid ">
        
        <div class="row justify-content-center mt-4 mb-3"> 
            <!--FORMULARIO DE REGISTRO DE EVENTOS-->
            <form class="col-10 col-sm-8  col-lg-6 col-xxl-4 redondeada pt-4 pb-4 ps-5 pe-5 bg-dark hidden"  style=" opacity: 0.9;" id="formularioRegistroEventos">
                <div class="row mt-2">
                    <h1 class="col-12 text-left">Registro de Eventos</h1>
                </div>
                <div class="row mt-3">
                    <div class="mb-3 col-12">
                        <label for="nombreFormularioNuevoEvento" class="form-label">Nombre del Evento</label>
                        <input type="text" class="form-control bg-transparent pointer border border-light" id="nombreFormularioNuevoEvento" name="nombre"  title="Introduce nombre del Evento">
                    </div>
                </div>
                <div class="row justify-content-between">
                    <div class="mb-3 col-12 col-md-5">
                        <label for="fechaInicioFormularioNuevoEvento" class="form-label">Fecha de Inicio</label>
                        <input type="date" class="form-control bg-transparent pointer border border-light" id="fechaInicioFormularioNuevoEvento" name="fechaInicio"  title="Introduce fecha de inicio">
                    </div>
                    <div class="mb-3 col-12 col-md-5">
                        <label for="fechaFinFormularioNuevoEvento" class="form-label">Fecha de Finalización</label>
                        <input type="date" class="form-control bg-transparent pointer border border-light" id="fechaFinFormularioNuevoEvento" name="fechaFin"  title="Introduce fecha de finalización">
                    </div>
                </div>
                <div class="row justify-content-between">
                    <div class="mb-3 col-12 col-md-5">
                        <label for="localidadFormularioNuevoEvento" class="form-label">Localidad</label>
                        <input type="text" class="form-control bg-transparent pointer border border-light" id="localidadFormularioNuevoEvento" name="localidad" title="Introduce localidad">
                    </div>
                    <div class="mb-3 col-12 col-md-5">
                        <label for="provinciaFormularioNuevoEvento" class="form-label">Provincia</label>
                        <select required name="provincia" class="form-control border border-light" id="provinciaFormularioNuevoEvento" title="Introduce provincia">
                          <option value="">. . .</option>
                          <option value="Álava">Álava</option>
                          <option value="Albacete">Albacete</option>
                          <option value="Alicante">Alicante</option>
                          <option value="Almería">Almería</option>
                          <option value="Asturias">Asturias</option>
                          <option value="Ávila">Ávila</option>
                          <option value="Badajoz">Badajoz</option>
                          <option value="Baleares">Baleares</option>
                          <option value="Barcelona">Barcelona</option>
                          <option value="Burgos">Burgos</option>
                          <option value="Cáceres">Cáceres</option>
                          <option value="Cádiz">Cádiz</option>
                          <option value="Cantabria">Cantabria</option>
                          <option value="Castellón">Castellón</option>
                          <option value="Ceuta">Ceuta</option>
                          <option value="Ciudad Real">Ciudad Real</option>
                          <option value="Córdoba">Córdoba</option>
                          <option value="Cuenca">Cuenca</option>
                          <option value="Girona">Girona</option>
                          <option value="Granada">Granada</option>
                          <option value="Guadalajara">Guadalajara</option>
                          <option value="Gipuzkoa">Gipuzkoa</option>
                          <option value="Huelva">Huelva</option>
                          <option value="Huesca">Huesca</option>
                          <option value="Jaén">Jaén</option>
                          <option value="A Coruña">A Coruña</option>
                          <option value="La Rioja">La Rioja</option>
                          <option value="Las Palmas">Las Palmas</option>
                          <option value="León">León</option>
                          <option value="Lleida">Lleida</option>
                          <option value="Lugo">Lugo</option>
                          <option value="Madrid">Madrid</option>
                          <option value="Málaga">Málaga</option>
                          <option value="Melilla">Melilla</option>
                          <option value="Murcia">Murcia</option>
                          <option value="Navarra">Navarra</option>
                          <option value="Ourense">Ourense</option>
                          <option value="Palencia">Palencia</option>
                          <option value="Pontevedra">Pontevedra</option>
                          <option value="Salamanca">Salamanca</option>
                          <option value="Segovia">Segovia</option>
                          <option value="Sevilla">Sevilla</option>
                          <option value="Soria">Soria</option>
                          <option value="Tarragona">Tarragona</option>
                          <option value="Tenerife">Tenerife</option>
                          <option value="Teruel">Teruel</option>
                          <option value="Toledo">Toledo</option>
                          <option value="Valencia">Valencia</option>
                          <option value="Valladolid">Valladolid</option>
                          <option value="Bizkaia">Bizkaia</option>
                          <option value="Zamora">Zamora</option>
                          <option value="Zaragoza">Zaragoza</option>
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="mb-3 col-12">
                        <label for="webEventoFormularioNuevoEvento" class="form-label">Web del Evento</label>
                        <input type="text" class="form-control bg-transparent pointer border border-light" id="webEventoFormularioNuevoEvento" name="web"  title="Introduce web del evento">
                    </div>
                </div>
                <div class="row">
                    <div class="mb-3 col-12">
                        <label for="reglamentoFormularioNuevoEvento" class="form-label">Reglamento del Evento (PDF)</label>
                        <input type="file" class="form-control bg-transparent pointer border border-light" id="reglamentoFormularioNuevoEvento" name="reglamento"  title="Introduce reglamento del evento">
                    </div>
                    <!-- <div class="mb-3 col-4">
                      <label for="imagen" class="form-label">Cargar</label>
                      <span id="cargarCartel"  class="col-12 btn btn-light"><strong style="color: #2b3035 !important;">Cargar</strong></span>
                    </div> -->
                </div>
                <div class="row">
                  <div class="mb-3 col-12">
                      <label for="cartelFormularioNuevoEvento" class="form-label">Agregar cartel del Evento. Tamaño 9:16</label>
                      <input type="file" class="form-control bg-transparent pointer border border-light" id="cartelFormularioNuevoEvento" name="cartel" title="Introduce cartel del evento">
                  </div>
              </div>
                <!-- <div class="row">
                    <div class="mb-3 col-8">
                        <label for="imagenFormularioNuevoEvento" class="form-label">Galería de Imágenes (16:9)</label>
                        <input type="file" class="form-control bg-transparent pointer border border-light" id="imagenFormularioNuevoEvento">
                    </div>
                    <div class="mb-3 col-4">
                        <label for="cargarImagenFormularioNuevoEvento" class="form-label">Cargar</label>
                        <span id="cargarImagenFormularioNuevoEvento"  class="col-12 btn btn-light"><strong style="color: #2b3035 !important;">Cargar</strong></span>
                    </div>
                </div>                   -->
                <div class="row justify-content-center">
                    <div id="formAlertFormularioNuevoEvento" class="m-4">Pulsa Continuar para registrar carreras</div>
                    <!-- <input type="submit" value="Continuar" class="col-4 btn btn-warning" id="registrarEvento" style="color: #2b3035 !important;" name="continuar"> -->
                    <span   class="col-4 btn btn-warning" id="registrarEventoFormularioNuevoEvento" style="color: #2b3035 !important;" name="continuar"><strong style="color: #2b3035 !important;">Continuar</strong></span>
                </div>
            </form>

            <!--FORMULARIO DE REGISTRO DE CARRERAS-->
            <form class="col-10 col-sm-8  col-lg-6 col-xxl-4 redondeada pt-4 pb-4 ps-5 pe-5 bg-dark hidden"  style=" opacity: 0.9;" id="formularioRegistroCarreras">
                <div class="row justify-content-center mt-3">
                    <h1 class="col-10 text-left">Registro de Carrera</h1>
                    <p class="col-9 text-left mt-3">Completa este formulario para asociar una nueva Carrera a este evento. Pulsa <strong>Continuar</strong> para registrar más carreras en el mismo evento. Pulsa <strong>Finalizar</strong> cuando hayas terminado</p>
                    <hr class="divider">
                </div>
                <div class="row mt-3  justify-content-center">
                    <div class="mb-3 col-10">
                        
                        <label for="nombreFormularioNuevaCarrera" class="form-label">Nombre de Carrera</label>
                        <input type="text" class="form-control bg-transparent pointer border border-light" id="nombreFormularioNuevaCarrera" name="nombre" title="Introduce nombre de la carrera">
                        
                    </div>
                    
                </div>
                <div class="row justify-content-center mt-3">
                    <p class="col-10 ">Rango de edad de los participantes: </p>
                </div>
                <div class="row justify-content-evenly">
                    
                    <div class="mb-3 col-10 col-md-4">
                        <label for="fechaMinFormularioNuevaCarrera" class="form-label">Nacidos después de... </label>
                        <input type="date" class="form-control bg-transparent pointer border border-light" id="fechaMinFormularioNuevaCarrera" name="fechaMin" title="Introduce fecha de nacimiento">
                    </div>
                    <div class="mb-3 col-10 col-md-4">
                        <label for="fechaMaxFormularioNuevaCarrera" class="form-label">Nacidos antes de... </label>
                        <input type="date" class="form-control bg-transparent pointer border border-light" id="fechaMaxFormularioNuevaCarrera" name="fechaMax" title="Introduce fecha de nacimiento">
                    </div>
                </div>
                <div class="row justify-content-evenly">
                    <div class="mb-3 col-10 col-md-4">
                        <label for="modalidadFormularioNuevaCarrera" class="form-label">Modalidad: </label>
                        <select class="form-select  border-light" id="modalidadFormularioNuevaCarrera" title="Introduce modalidad de la carrera" name="modalidad">
                            <option selected>Modalidad</option>
                            <option value="maraton">Maratón</option>
                            <option value="trail">Trail</option>
                            <option value="ultra">Ultra</option>
                        </select>
                    </div>
                    <div class="mb-3 col-10 col-md-4">
                        <label for="categoriaFormularioNuevaCarrera" class="form-label">Categoría: </label>
                        <select class="form-select border-light" id="categoriaFormularioNuevaCarrera" title="Introduce categoría de la carrera" name="categoria">
                            <option selected>Categoría</option>
                            <option value="hombres">Hombres</option>
                            <option value="mujeres">Mujeres</option>
                            <option value="mixto">Mixto</option>
                        </select>
                    </div>
                </div>
                <div class="row  justify-content-center">
                    <div class=" col-10">
                        <label for="recorridoFormularioNuevaCarrera" class="form-label">Recorrido de la Carrera (GPX)</label>
                        <input type="file" class="form-control bg-transparent pointer border border-light" id="recorridoFormularioNuevaCarrera" title="Introduce recorrido de la carrera" name="recorrido">
                    </div>
                </div>
                <div class="row justify-content-center">
                    <div id="formAlertFormularioNuevaCarrera" class="mb-3 mt-3 col-10"></div>
                </div>
                <div class="row justify-content-around mb-2">
                    
                    <span  id="registrarOtraCarreraFormularioNuevaCarrera" class="col-4 btn btn-warning" ><strong style="color: #2b3035 !important;">Continuar</strong></span>
                    <span  id="registrarCarreraFormularioNuevaCarrera" class="col-4 btn btn-success"><strong>Finalizar</strong></span>
                </div>
            </form>

            <!--FORMULARIO DE LOGIN-->
            <form class="col-10 col-sm-8  col-lg-6 col-xxl-4 redondeada pt-4 pb-4 ps-5 pe-5 bg-dark hidden"  style=" opacity: 0.9;" id="formularioLogin">
                <div class="row mt-2">
                    <h1 class="col-12 text-left">Inicio de Sesión</h1>
                </div>
                <div class="row mt-3 justify-content-center">
                    <div class="mb-3 col-10 mt-5">
                        <label for="emailFormularioLogin" class="form-label">Correo Electrónico</label>
                        <input type="email" class="form-control bg-transparent pointer pointer  border border-light " id="emailFormularioLogin" name="email" title="Introduce correo electrónico">
                    </div>
                    <div class="mb-3 col-10 mt-2">
                      <label for="password" class="form-label">Contraseña</label>
                      <input type="password" class="form-control bg-transparent pointer pointer border border-light" id="passwordFormularioLogin" name="password" title="Introduce contraseña">
                    </div>
                    
                    <div class="row justify-content-center">
                      <div id="formAlertFormularioLogin" class="m-3 col-10">&nbsp;</div>
                    </div>
                    <div id="iniciarSesionFormularioLogin" class="border border-light mb-3 mt-5 col-8 col-md-6 col-xl-5 p-2 rounded text-center" style="cursor: pointer">Iniciar Sesión</div>
                    <span id="renderFormularioRegistroFormularioLogin" class="mb-3 mt-5 col-10 text-center underline pointer" style="color: #f8f9fa; text-decoration: underline; text-underline-offset: 0.3em;">¿Todavía no tienes una cuenta?<br>Registrate aquí</span>
                </div>
            </form>

            <!--FORMULARIO DE REGISTRO-->
            <form class="col-10 col-sm-8  col-lg-6 col-xxl-4 redondeada pt-4 pb-4 ps-5 pe-5 bg-dark hidden"  style=" opacity: 0.9;" id="formularioRegistro">
                <div class="row mt-2">
                    <h1 class="col-12 text-left">Registro de Usuario</h1>
                </div>
                <div class="row mt-3 justify-content-center">
                    <div class="mb-3 col-12">
                        <label for="emailFormularioRegistro" class="form-label">Correo Electrónico</label>
                        <input type="email" class="form-control bg-transparent border border-light" id="emailFormularioRegistro">
                    </div>
                    <div class="mb-3 col-12">
                      <label for="passwordFormularioRegistro" class="form-label">Contraseña</label>
                      <input type="password" class="form-control bg-transparent border border-light" id="passwordFormularioRegistro">
                    </div>
                    <div class="mb-3 col-12">
                      <label for="password2FormularioRegistro" class="form-label">Confirmar Contraseña</label>
                      <input type="password" class="form-control bg-transparent border border-light" id="password2FormularioRegistro">
                    </div>
                    <div class="mb-3 col-12 mt-4 align-left">
                        <div class="form-check">
                            <input class="form-check-input pointer" type="checkbox" value="true" id="isAdminFormularioRegistro" name="isAdmin" placeholder="Marca para registrar cuenta de organizador" title="Marca para registrar cuenta de organizador">
                            <label class="form-check-label pointer" for="isAdminFormularioRegistro">
                                Soy una entidad organizadora de eventos
                            </label>
                        </div>
                    </div>
                    <div class="row justify-content-left">
                      <div id="formAlertFormularioRegistro" class="m-3 col-10">&nbsp;</div>
                    </div>
                    <div id="registrarUsuarioFormularioRegistro" class="border border-light mb-3 mt-5 col-8 col-md-6 col-xl-5 p-2 rounded text-center" style="cursor: pointer">Registrar Usuario</div>
                    <div id="renderFormularioLoginFormularioRegistro" class="mb-3 mt-5 col-10 text-center underline pointer" style="color: #f8f9fa; text-decoration: underline; text-underline-offset: 0.3em;">¿Ya tienes una cuenta?<br>Inicia Sesión aquí</div>
                </div>
            </form>

            <!--FORMULARIO COMPLETAR REGISTRO DE ORGANIZADOR-->
            <form class="col-10 col-sm-8  col-lg-6 col-xxl-4 redondeada pt-4 pb-4 ps-5 pe-5 bg-dark hidden"  style=" opacity: 0.9;" id="formularioCompletarRegistroOrganizador">
                <div class="row mt-2">
                    <h1 class="col-12 text-left">Completa tu Registro</h1>
                </div>
                <div class="row mt-3 justify-content-center">
                    <div class="mb-3 col-12">
                        <label for="nombreFormularioCompletarRegistroOrganizador" class="form-label">Nombre</label>
                        <input type="text" class="form-control bg-transparent border border-light" id="nombreFormularioCompletarRegistroOrganizador" title="Introduce nombre" name="nombre"> 
                    </div>
                    <div class="mb-3 col-12">
                      <label for="nicknameFormularioCompletarRegistroOrganizador" class="form-label">Nickname</label>
                      <input type="text" class="form-control bg-transparent border border-light" id="nicknameFormularioCompletarRegistroOrganizador" title="Introduce nickname" name="nickname">
                    </div>
                    <div class="mb-3 col-12">
                      <label for="fechaNacimientoFormularioCompletarRegistroOrganizador" class="form-label">Fecha de Nacimiento</label>
                      <input type="date" class="form-control bg-transparent border border-light" id="fechaNacimientoFormularioCompletarRegistroOrganizador" title="Introduce fecha de nacimiento" name="fechaNacimiento">
                    </div>
                    <div class="mb-3 col-12">
                      <label for="fotoPerfilFormularioCompletarRegistroOrganizador" class="form-label">Foto de Perfil. Requiere formato 1:1</label>
                      <input type="file" class="form-control bg-transparent border border-light" id="fotoPerfilFormularioCompletarRegistroOrganizador" title="Introduce foto de perfil" name="fotoPerfil">
                    </div>
                    <div class="mb-3 col-12">
                      <label for="nombreEntidadFormularioCompletarRegistroOrganizador" class="form-label">Nombre de la Entidad</label>
                      <input type="text" class="form-control bg-transparent border border-light" id="nombreEntidadFormularioCompletarRegistroOrganizador" title="Introduce nombre de la entidad" name="entidadOrganizadora">
                    </div>
                    <div class="mb-3 col-12">
                      <label for="telefonoFormularioCompletarRegistroOrganizador" class="form-label">Teléfono</label>
                      <input type="text" class="form-control bg-transparent border border-light" id="telefonoFormularioCompletarRegistroOrganizador" title="Introduce teléfono" name="telefono">
                    </div>
                    <div class="row justify-content-center">
                      <div id="formAlertFormularioCompletarRegistroOrganizador" class="m-3 col-10">&nbsp;</div>
                    </div>
                    <div id="registrarUsuarioFormularioCompletarRegistroOrganizador" class="border border-light mb-3 mt-5 col-8 col-md-6 col-xl-5 p-2 rounded text-center" style="cursor: pointer">Completar Registro</div>
                </div>
            </form>

            <!--FORMLARIO COMPLETAR REGISTRO USUARIO-->
            <form class="col-10 col-sm-8  col-lg-6 col-xxl-4 redondeada pt-4 pb-4 ps-5 pe-5 bg-dark hidden"  style=" opacity: 0.9;" id="formularioCompletarRegistroUsuario">
              <div class="row mt-2">
                  <h1 class="col-12 text-left">Completa tu Registro</h1>
              </div>
              <div class="row mt-3 justify-content-center">
                  <div class="mb-3 col-12">
                      <label for="nombreFormularioCompletarRegistroUsuario" class="form-label">Nombre</label>
                      <input type="text" class="form-control bg-transparent border border-light" id="nombreFormularioCompletarRegistroUsuario" title="Introduce nombre" name="nombre">
                  </div>
                  <div class="mb-3 col-12">
                    <label for="nicknameFormularioCompletarRegistroUsuario" class="form-label">Nickname</label>
                    <input type="text" class="form-control bg-transparent border border-light" id="nicknameFormularioCompletarRegistroUsuario" title="Introduce nickname" name="nickname">
                  </div>
                  <div class="mb-3 col-12">
                    <label for="fechaNacimientoFormularioCompletarRegistroUsuario" class="form-label">Fecha de Nacimiento</label>
                    <input type="date" class="form-control bg-transparent border border-light" id="fechaNacimientoFormularioCompletarRegistroUsuario" title="Introduce fecha de nacimiento" name="fechaNacimiento">
                  </div>
                  <div class="mb-3 col-12">
                    <label for="fotoPerfilFormularioCompletarRegistroUsuario" class="form-label">Foto de Perfil. Requiere formato 1:1</label>
                    <input type="file" class="form-control bg-transparent border border-light" id="fotoPerfilFormularioCompletarRegistroUsuario" title="Introduce foto de perfil" name="fotoPerfil">
                  </div>
                  <div class="row justify-content-center">
                    <div id="formAlertFormularioCompletarRegistroUsuario" class="m-3 col-10">&nbsp;</div>
                  </div>
                  <div id="registrarUsuarioFormularioCompletarRegistroUsuario" class="border border-light mb-3 mt-5 col-8 col-md-6 col-xl-5 p-2 rounded text-center" style="cursor: pointer">Completar Registro</div>
              </div>

            </form>
      </div>
      <div id="mainPage">
          <!--ESTE CONTENIDO CARGA DE FORMA DINÁMICA EL CATALOGO DE CARRERAS-->
      </div>
      <div id="cuentaUsuario">

      </div>
  </main>

    

</body>
<script>

//////////////////////////
//NOTAS
/////////////////////////
// 1 - CONTROLAR LA FORMA DEL RESPONSE DATA DEL QUE SACO EL TOKEN JWT PARA GUARDARLO EN LOCALSTORAGE EN EL LOGIN
// 2 - HAY PAGINAS EN LAS QUE EL CONTENIDO DEL NAVBAR TIENE QUE CAMBIAR SEGUN SI EL USUARIO ESTA LOGUEADO O NO
// 3 - HAY QUE CONTROLAR QUE EL USUARIO NO PUEDA ACCEDER A PAGINAS SIN ESTAR LOGUEADO
// 4 - HAY QUE CONTROLAR LAS URLS DE LAS APIS

////
//NOTAS API
////
// 1 - COMRPOBAR EL HEADER AUTH JWT EN CADA PETICION -> SI LA PETICION TIENE QUE VER CON MANEJO DE EVENTOS ENVIA TAMBIEN EL ID DEL EVENTO Y/O CARRERA

////
//Variables
////
let jwt;
let formData;
let token;
//////////////////////////
//FUNCIONALIDAD NAVBAR
/////////////////////////
const enlaceCuenta = document.getElementById('enlaceCuenta');


enlaceCuenta.addEventListener('click', (e) => {
    e.preventDefault();
    // //obtengo el token del localstorage
    // jwt = localStorage.getItem('jwt');
    // //compruebo que esta seteado
    // if(jwt){
    //   if(!JWT_isValid(jwt)){
    //     fetch('http://localhost:3000/backend/api_racebook/v4/usuario/', {
    //     method: 'POST',
    //     headers: {
    //         'Authorization': `Bearer ${jwt}`
    //     }
    //     })
    //     .then(response => response.json())
    //     .then(data => {
        
    //     cuentaUsuario.innerHTML = '';
    //     cuentaUsuario.classList.toggle('hidden');
    //     cuentaUsuario.innerHTML = `
    //     <div class="row justify-content-center">
    //         <div class="col-12 col-md-6 col-lg-4 col-xxl-3 redondeada bg-dark p-3 sombra">
    //         <h1 class="text-center">Cuenta de Usuario</h1>
    //         <p>Nombre: ${data.nombre}</p>
    //         <p>Email: ${data.email}</p>
    //         <p>Fecha de Nacimiento: ${data.fechaNacimiento}</p>
    //         <p>Nickname: ${data.nickname}</p>
    //         <p>Entidad: ${data.entidad}</p>
    //         <p>Telefono: ${data.telefono}</p>
    //         <p>Web: ${data.web}</p>
    //         <p>Localidad: ${data.localidad}</p>
    //         <p>Provincia: ${data.provincia}</p>
    //         <p>Es Administrador: ${data.isAdmin}</p>
    //         <p>Es Organizador: ${data.isOrganizador}</p>
    //         <p>Es Usuario: ${data.isUser}</p>
    //         <p>Es Activo: ${data.isActive}</p>
    //         </div>
    //         </div>
    //         `;
    //     });
    //   }else{
    //       formularioLogin.classList.toggle('hidden');
    //       formAlertFormularioLogin.textContent = 'Tu sesión ha caducado. Por favor, inicia sesión de nuevo';
    //   }
    // }
    formularioLogin.classList.toggle('hidden');
    
});

//////////////////////////
//REG EXP
/////////////////////////
const regPasswd = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[$@$!%*?#&])([A-Za-z\d$@$!%*?&#]|[^ ]){8,16}$/;
const regEmail = /^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/;
//////////////////////////
//MAIN PAGE
/////////////////////////
const cuentaUsuario = document.getElementById('cuentaUsuario');
//////////////////////////////////////////////////
//FUNCION PARA RENDERIZAR EL CATALOGO DE CARRERAS
//////////////////////////////////////////////////

// function renderCatalogoCarreras(){
//   const urlCatalogoCarreras = 'http://localhost:3000/backend/api_racebook/v4/catalogo_carreras/';
//   fetch(urlCatalogoCarreras)
//   .then(response => response.json())
//   .then(data => {
//     const mainPage = document.getElementById('mainPage');
//     mainPage.innerHTML = '';
//     data.forEach(carrera => {
//       const card = document.createElement('div');
//       card.classList.add('card', 'col-10', 'col-sm-8', 'col-md-6', 'col-lg-4', 'col-xxl-3', 'm-3', 'p-3', 'sombra');
//       card.innerHTML = `
//       <img src="${carrera.cartel}" class="card-img-top" alt="...">
//       <div class="card-body">
//         <h5 class="card-title">${carrera.nombre}</h5>
//         <p class="card-text">${carrera.localidad}, ${carrera.provincia}</p>
//         <p class="card-text">${carrera.fecha}</p>
//         <a href="#" class="btn btn-primary">Ver más</a>
//       </div>
//       `;
//       mainPage.appendChild(card);
//     });
//     //si es un usuario logueado con un token valido añado funcionalidades al catalogo
//     // 1 EL BOTON DE LOGIN DEL NAVBAR AHORA ES UN ENLACE A LA PAGINA DE CUENTA -> SI ES ORGANIZADOR PUEDE ACCEDER A UNA PAGINA DE GESTION DE EVENTOS
//     // 2 CADA EVENTO TIENE UN TRIGGER QUE RENDERIZA LOS DETALLES DEL EVENTO
//     // 3 ENTRE LOS DETALLES DEL EVENTO SE ENCUENTRAN EL LISTADO DE CARRERAS (CON UN TRIGGER PARA ACCEDER A LOS DETALLES DE CADA CARRERA)

//   });
// }





//////////////////////////
//FORMULARIO REGISTRO
/////////////////////////
//url api para el registro
const urlFormularioRegistro = 'http://localhost:3000/apiv4/insert/usuario/';

//variables para los campos del formulario
const formularioRegistro = document.getElementById('formularioRegistro');
const emailFormularioRegistro = document.getElementById('emailFormularioRegistro');
const passwordFormularioRegistro = document.getElementById('passwordFormularioRegistro');
const password2FormularioRegistro = document.getElementById('password2FormularioRegistro');
const isAdminFormularioRegistro = document.getElementById('isAdminFormularioRegistro');

const formAlertFormularioRegistro = document.getElementById('formAlertFormularioRegistro');

const registrarUsuarioFormularioRegistro = document.getElementById('registrarUsuarioFormularioRegistro');
const renderFormularioLoginFormularioRegistro = document.getElementById('renderFormularioLoginFormularioRegistro');

renderFormularioLoginFormularioRegistro.addEventListener('click', (e) => {
  e.preventDefault();
  formularioRegistro.classList.toggle('hidden');
  formularioLogin.classList.toggle('hidden');
});

registrarUsuarioFormularioRegistro.addEventListener('click', (e) => {
    e.preventDefault();
    if(emailFormularioRegistro.value == '' || passwordFormularioRegistro.value == '' || password2FormularioRegistro.value == ''){
      formAlertFormularioRegistro.textContent = 'Rellena todos los campos';
    }else if(passwordFormularioRegistro.value != password2FormularioRegistro.value){
      formAlertFormularioRegistro.textContent = 'Las contraseñas no coinciden';
    }else if(!regEmail.test(emailFormularioRegistro.value)){
        formAlertFormularioRegistro.textContent = 'El email no es válido';
    }else if(!regPasswd.test(passwordFormularioRegistro.value)){
        formAlertFormularioRegistro.innerHTML = 'La contraseña es demasiado débil. <br> Debe contener al menos 8 caracteres, una mayúscula, una minúscula, un número y un caracter especial';
    }else{
        fetch(urlFormularioRegistro, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json;utf-8'
          },
          body: JSON.stringify({
            email: emailFormularioRegistro.value,
            password: passwordFormularioRegistro.value,
            isAdmin: isAdminFormularioRegistro.checked
          }),
          mode: 'cors',
        })
        .then(response => {
          if(response.status == 201){
            return response.json();
          }else if(response.status == 202){
            formAlertFormularioRegistro.textContent = 'Este email ya está registrado';
          }else{
            formAlertFormularioRegistro.textContent = 'Ahora mismo no podemos registrar tu cuenta. Inténtalo más tarde';
          }
        })
        .then(data => {
            if(data){
            localStorage.setItem('jwt', data);
            //decodifico el token 
            token = data.split('.')[1];
            console.log(token);
            token = atob(token);       
            console.log(token);
            console.log(typeof token);
            token = JSON.parse(token);
            console.log(typeof token);
            
            if(isAdminFormularioRegistro.checked){
                formularioRegistro.classList.toggle('hidden');
                formularioCompletarRegistroOrganizador.classList.toggle('hidden');
            }else{
                formularioRegistro.classList.toggle('hidden');
                formularioCompletarRegistroUsuario.classList.toggle('hidden'); 
            }
            //vacio el formulario 
            formularioRegistro.reset();
          }
        })

    }
});

////////////////////////////////////////
//FORMULARIO COMPLETAR REGISTRO USUARIO
///////////////////////////////////////

//url api para completar el registro de usuario
const urlFormularioCompletarRegistroUsuario = 'http://localhost:3000/apiv4/insert/usuario/usuario/';

//variables para los campos del formulario
const formularioCompletarRegistroUsuario = document.getElementById('formularioCompletarRegistroUsuario');
const nombreFormularioCompletarRegistroUsuario = document.getElementById('nombreFormularioCompletarRegistroUsuario');
const nicknameFormularioCompletarRegistroUsuario = document.getElementById('nicknameFormularioCompletarRegistroUsuario');
const fechaNacimientoFormularioCompletarRegistroUsuario = document.getElementById('fechaNacimientoFormularioCompletarRegistroUsuario');
const fotoPerfilFormularioCompletarRegistroUsuario = document.getElementById('fotoPerfilFormularioCompletarRegistroUsuario');
const formAlertFormularioCompletarRegistroUsuario = document.getElementById('formAlertFormularioCompletarRegistroUsuario');
const registrarUsuarioFormularioCompletarRegistroUsuario = document.getElementById('registrarUsuarioFormularioCompletarRegistroUsuario');

registrarUsuarioFormularioCompletarRegistroUsuario.addEventListener('click', (e) => {
  e.preventDefault();
  if(nombreFormularioCompletarRegistroUsuario.value == '' || nicknameFormularioCompletarRegistroUsuario.value == '' || fechaNacimientoFormularioCompletarRegistroUsuario.value == '' || fotoPerfilFormularioCompletarRegistroUsuario.value == ''){
    formAlertFormularioCompletarRegistroUsuario.textContent = 'Rellena todos los campos';
  }else{
      e.preventDefault();
      //obtengo el token del localstorage
      jwt = localStorage.getItem('jwt');
      //compruebo que esta seteado
      if(jwt){
        //decodifico el token 
        token = jwt.split('.')[1];
        console.log(token);
        token = atob(token);       
        console.log(token);
        console.log(typeof token);
        token = JSON.parse(token);
        console.log(typeof token);
        //compruebo que el token es valido
        if(token.userData.userId){
          formData = new FormData(formularioCompletarRegistroUsuario);
          fetch(urlFormularioCompletarRegistroUsuario, {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${localStorage.getItem('jwt')}`
            },
            body: formData,
            mode: 'cors',
          })
          .then(response => {
            if(response.status == 201){
              return response.json();
            }else if(response.status == 202){
              formAlertFormularioCompletarRegistroUsuario.textContent = 'Error al completar el registro, vuelve a completar el formulario o registrate con otro email';
            }else{
              formAlertFormularioCompletarRegistroUsuario.textContent = 'Error al completar el registro';
              //espero 6 segundos
              setTimeout(() => {
                  formularioCompletarRegistroUsuario.classList.toggle('hidden');
                  //vacio el formulario 
                  formularioCompletarRegistroUsuario.reset();
                  formularioRegistro.classList.toggle('hidden');
                }, 6000);
            }
          })
          .then(data => {
            if(data){
              localStorage.setItem('jwt', data);
              formularioCompletarRegistroUsuario.classList.toggle('hidden');
              //vacio el formulario 
              formularioCompletarRegistroUsuario.reset();
              formularioLogin.classList.toggle('hidden');
            }
          })
        }else{
          formAlertFormularioRegistro.textContent = 'No se pudo completar el registro. Prueba con otro email';;
          //oculto el formulario de completar registro y muestro otra vez el de registro
          formularioCompletarRegistroUsuario.classList.toggle('hidden');
          formularioRegistro.classList.toggle('hidden');
          //elimino el token del localstorage
          localStorage.clear();
          //vacio el formulario 
          formularioCompletarRegistroUsuario.reset();
      }
    }
  } 
});

///////////////////////////////////////////
//FORMULARIO COMPLETAR REGISTRO ORGANIZADOR
///////////////////////////////////////////

//url api para completar el registro de organizador
const urlFormularioCompletarRegistroOrganizador = 'http://localhost:3000/apiv4/insert/usuario/organizador/';
//variables para los campos del formulario
const formularioCompletarRegistroOrganizador = document.getElementById('formularioCompletarRegistroOrganizador');
const nombreFormularioCompletarRegistroOrganizador = document.getElementById('nombreFormularioCompletarRegistroOrganizador');
const nicknameFormularioCompletarRegistroOrganizador = document.getElementById('nicknameFormularioCompletarRegistroOrganizador');
const fechaNacimientoFormularioCompletarRegistroOrganizador = document.getElementById('fechaNacimientoFormularioCompletarRegistroOrganizador');
const fotoPerfilFormularioCompletarRegistroOrganizador = document.getElementById('fotoPerfilFormularioCompletarRegistroOrganizador');
const nombreEntidadFormularioCompletarRegistroOrganizador = document.getElementById('nombreEntidadFormularioCompletarRegistroOrganizador');
const telefonoFormularioCompletarRegistroOrganizador = document.getElementById('telefonoFormularioCompletarRegistroOrganizador');
const formAlertFormularioCompletarRegistroOrganizador = document.getElementById('formAlertFormularioCompletarRegistroOrganizador');
const registrarUsuarioFormularioCompletarRegistroOrganizador = document.getElementById('registrarUsuarioFormularioCompletarRegistroOrganizador');

registrarUsuarioFormularioCompletarRegistroOrganizador.addEventListener('click', (e) => {
  e.preventDefault();
  if(nombreFormularioCompletarRegistroOrganizador.value == '' || nicknameFormularioCompletarRegistroOrganizador.value == '' || fechaNacimientoFormularioCompletarRegistroOrganizador.value == '' || fotoPerfilFormularioCompletarRegistroOrganizador.value == '' || nombreEntidadFormularioCompletarRegistroOrganizador.value == '' || telefonoFormularioCompletarRegistroOrganizador.value == ''){
    formAlertFormularioCompletarRegistroOrganizador.textContent = 'Rellena todos los campos';
  }else{
    //obtengo el token del localstorage
    jwt = localStorage.getItem('jwt');
      //compruebo que esta seteado
      if(jwt){
        //decodifico el token 
        token = jwt.split('.')[1];
        console.log(token);
        token = atob(token);       
        console.log(token);
        console.log(typeof token);
        token = JSON.parse(token);
        console.log(typeof token);
        //compruebo que el token es valido
        if(token.userData.userId){
            let formDataCompletarRegistroOrganizador = new FormData(formularioCompletarRegistroOrganizador);
            fetch(urlFormularioCompletarRegistroOrganizador, {
              method: 'POST',
              headers: {
                'Authorization': `Bearer ${localStorage.getItem('jwt')}`
              },
              body: formDataCompletarRegistroOrganizador,
            })
            .then(response => {
              if(response.status == 201){
                return response.json();
              }else if(response.status == 202){
                formAlertFormularioCompletarRegistroOrganizador.textContent = 'Error al completar el registro, vuelve a completar el formulario o registrate con otro email'; 
              }else{
                formAlertFormularioCompletarRegistroOrganizador.textContent = 'Error al completar el registro';
                //espero 6 segundos
                setTimeout(() => {
                  formularioCompletarRegistroOrganizador.classList.toggle('hidden');
                  //vacio el formulario
                  formularioCompletarRegistroOrganizador.reset();
                  formularioRegistro.classList.toggle('hidden');
                }, 6000);
              }
            })
            .then(data => {
              if(data){
                localStorage.setItem('jwt', data);
                // console.log(data);
                formularioCompletarRegistroOrganizador.classList.toggle('hidden');
                //vacio el formulario
                formularioCompletarRegistroOrganizador.reset();
                formularioLogin.classList.toggle('hidden');
              }
            })
        }else{
            formAlertFormularioRegistro.textContent = 'No se pudo completar el registro. Prueba con otro email';;
            //oculto el formulario de completar registro y muestro otra vez el de registro
            formularioCompletarRegistroOrganizador.classList.toggle('hidden');
            formularioRegistro.classList.toggle('hidden');
            //elimino el token del localstorage
            localStorage.clear();
            //vacio el formulario
            formularioCompletarRegistroOrganizador.reset();
        }
      }
  }
});


//////////////////////////
//FORMULARIO LOGIN
/////////////////////////
//url api para el login
const urlFormularioLogin = 'http://localhost:3000/apiv4/login/';

//variables para los campos del formulario
const formularioLogin = document.getElementById('formularioLogin');

const emailFormularioLogin = document.getElementById('emailFormularioLogin');
const passwordFormularioLogin = document.getElementById('passwordFormularioLogin');

const formAlertFormularioLogin = document.getElementById('formAlertFormularioLogin');

const iniciarSesionFormularioLogin = document.getElementById('iniciarSesionFormularioLogin');
const renderFormularioRegistroFormularioLogin = document.getElementById('renderFormularioRegistroFormularioLogin');

renderFormularioRegistroFormularioLogin.addEventListener('click', (e) => {
  e.preventDefault();
  formularioLogin.classList.toggle('hidden');
  formularioRegistro.classList.toggle('hidden');
});

iniciarSesionFormularioLogin.addEventListener('click', (e) => {
  e.preventDefault();
  if(emailFormularioLogin.value == '' || passwordFormularioLogin.value == ''){
    formAlertFormularioLogin.textContent = 'Rellena todos los campos';
  }else{
    console.log(emailFormularioLogin.value);
    console.log(passwordFormularioLogin.value);
    formData = new FormData(formularioLogin);
    fetch(urlFormularioLogin, {
      method: 'POST',
      body: formData,
    })
    .then(response => {
      console.log('por aqui paso');
      console.log(response.status);
      console.log(response);
      if(response.status == 201){
        console.log('se que es  un 201');
        return response.json();
      }else{
        formAlertFormularioLogin.textContent = 'Usuario o contraseña incorrectos';
      }
    })
    .then(data => {
      console.log('por aqui si paso');
      if(data){
        console.log(data);
        localStorage.setItem('jwt', data);
        //decodifico el token 
        let token = data.split('.')[1];
        // console.log(token);
        token = atob(token);       
        // console.log(token);
        // console.log(token);
        // console.log(typeof token);//es un string
        token = JSON.parse(token);
        if(token.userData.completado){
          window.alert('completado');
          formularioLogin.classList.toggle('hidden');
          
          // renderMainPage();
        }else if(token.isAdmin){
          formularioLogin.classList.toggle('hidden');
          formularioCompletarRegistroOrganizador.classList.toggle('hidden');
        }else{
          formularioLogin.classList.toggle('hidden');
          formularioCompletarRegistroUsuario.classList.toggle('hidden');
        }
      }
    })
    .catch(error => {
      formAlertFormularioLogin.textContent = 'Error al iniciar sesión';
    });
  }
});

//////////////////////////
//FORMULARIO NUEVO EVENTO
//////////////////////////

  //https://www.npmjs.com/package/exif-js Libreria para controlar el tamaño de foto
const urlFormularioNuevoEvento = 'http://localhost:3000/backend/api_racebook/eventos/new/';
const urlArchivosFormularioNuevoEvento = 'http://localhost:3000/backend/api_racebook/eventos/new_archivos/';
const formFormularioNuevoEvento = document.getElementById('formularioRegistroEventos');
const imagenFormularioNuevoEvento = document.getElementById('imagenFormularioNuevoEvento');
const formAlertFormularioNuevoEvento = document.getElementById('formAlertFormularioNuevoEvento');
const nombreFormularioNuevoEvento = document.getElementById('nombreFormularioNuevoEvento'); 
const fechaInicioFormularioNuevoEvento = document.getElementById('fechaInicioFormularioNuevoEvento');
const fechaFinFormularioNuevoEvento = document.getElementById('fechaFinFormularioNuevoEvento'); 
const localidadFormularioNuevoEvento = document.getElementById('localidadFormularioNuevoEvento'); 
const provinciaFormularioNuevoEvento = document.getElementById('provinciaFormularioNuevoEvento');    
const webEventoFormularioNuevoEvento = document.getElementById('webEventoFormularioNuevoEvento'); 
const cartelFormularioNuevoEvento = document.getElementById('cartelFormularioNuevoEvento');
const registrarEventoFormularioNuevoEvento = document.getElementById('registrarEventoFormularioNuevoEvento');
const reglamentoFormularioNuevoEvento = document.getElementById('reglamentoFormularioNuevoEvento');

let contadorImagenesFormularioNuevoEvento = 0;

let eventoId;
registrarEventoFormularioNuevoEvento.addEventListener('click', (e) => {
    e.preventDefault();
    if(nombreFormularioNuevoEvento.value == '' || fechaInicioFormularioNuevoEvento.value == '' || fechaFinFormularioNuevoEvento.value == '' || localidadFormularioNuevoEvento.value == '' || provinciaFormularioNuevoEvento.value == '' || webEventoFormularioNuevoEvento.value == '' || reglamentoFormularioNuevoEvento.value == '' || cartelFormularioNuevoEvento.value == ''){
      formAlert.innerHTML = 'Rellena todos los campos';
    }else{
      let formDataFormularioNuevoEvento = new FormData(formFormularioNuevoEvento);

      fetch(urlArchivos, {
        headers: {
          'Authorization': `Bearer ${getLocalJWT()}`
        },
        method: 'POST',
        body: formDataFormularioNuevoEvento,
      })
      .then(response => {
        if(response.status == 201){
            return response.json();
        }else{
          formAlertFormularioNuevoEvento.textContent = 'Ha habido un error al registrar el evento si no sabes que ocurre llama a la policía';
        }   
      })
      .then(data => {
            //guardo una variable con el id del evento
            localStorage.setItem('eventoId', data.eventoId);
            formFormularioNuevoEvento.classList.toggle('hidden');
            formFormularioNuevaCarrera.classList.toggle('hidden');
      })

    }
  });

//////////////////////////
//FORMULARIO NUEVA CARRERA
//////////////////////////

  //url para la llamada de la api a: 'insertar carrera en evento'
    const urlFormularioNuevaCarrera = 'http://localhost:3000/backend/api_racebook/v4/insert/carrera/'; 

  //guardo las variables correspondientes a las variables del formulario de registro de carreras 
    const nombreFormularioNuevaCarrera = document.getElementById('nombreFormularioNuevaCarrera');
    const fechaMinFormularioNuevaCarrera = document.getElementById('fechaMinFormularioNuevaCarrera');
    const fechaMaxFormularioNuevaCarrera = document.getElementById('fechaMaxFormularioNuevaCarrera');
    const modalidadFormularioNuevaCarrera = document.getElementById('modalidadFormularioNuevaCarrera');
    const categoriaFormularioNuevaCarrera = document.getElementById('categoriaFormularioNuevaCarrera');
    const recorridoFormularioNuevaCarrera = document.getElementById('recorridoFormularioNuevaCarrera');
    const registrarCarreraFormularioNuevaCarrera = document.getElementById('registrarCarreraFormularioNuevaCarrera');
    const registrarOtraCarreraFormularioNuevaCarrera = document.getElementById('registrarOtraCarreraFormularioNuevaCarrera');
    const formAlertFormularioNuevaCarrera = document.getElementById('formAlertFormularioNuevaCarrera');
    const formFormularioNuevaCarrera = document.getElementById('formularioRegistroCarreras');
    


</script>

</html>