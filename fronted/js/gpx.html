<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/togeojson/0.16.0/togeojson.min.js" integrity="sha512-tGbo6fmjjGoMjPcSMmwn2kdL791LM73K/8dUjCdO91fBBF26AXG7/DKFcVHfOieY78XT2hl0rJkbM0GUVaPcjw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
    <form action="">
        <input type="file" name="gpx" id="gpx">
    </form>
</body>
<script>
    const inputGPX = document.getElementById('gpx');
    inputGPX.addEventListener('change', (e) => {
        const gpxFile = inputGPX.files[0];
        //obtengo el nombre del fichero para comprobar la extension
        const gpxFileName = gpxFile.name;
        const gpxFileExtension = gpxFileName.split('.').pop();
        //compruebo que tenga contenido y sea un gpx
        if (gpxFile && gpxFileExtension === 'gpx') {
            const reader = new FileReader();
            reader.readAsText(gpxFile);
            reader.onload = (e) => {
                const gpxContent = e.target.result;
                // console.log(gpxContent);
                const parser = new DOMParser();
                const gpxXML = parser.parseFromString(gpxContent, 'application/xml');
                const geoJSON = toGeoJSON.gpx(gpxXML);
                const geoFeatures = geoJSON.features[0];
                const geoCoordinates = geoFeatures.geometry.coordinates;
                const cantidadPuntosTotal = geoCoordinates.length;
                const intervaloProvisionalPuntos = cantidadPuntosTotal / 200;
                const intervaloPuntos = Math.round(intervaloProvisionalPuntos) > 1 ? Math.round(intervaloProvisionalPuntos) : 1;
                const coordenadasTrayecto = {};
                for(let i = 0; i < cantidadPuntosTotal; i += intervaloPuntos) {
                    const punto = geoCoordinates[i];
                    coordinate = {
                        lon: punto[1],
                        lat: punto[0],
                        alt: punto[2],
                    };
                    coordenadasTrayecto = {
                        ... coordenadasTrayecto,
                       ... coordinate,
                    };
                    }
                }
                console.log(coordenadasTrayecto);
            }
            
        }
    });

</script>
</html>