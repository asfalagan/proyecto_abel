use racebook;
select * from usuario;
SELECT * FROM EVENTO;
SELECT * FROM carrera;
select * from usuario_organizador;
SELECT * FROM completados;
SELECT insertar_evento('a','a','a','a','a','a',1);
CREATE TABLE jsonPruebas (
	jsonUsuario json
);
INSERT INTO carrera (id_evento, recorrido) VALUES (1 , '"[{"latitud":42.91356,"longitud":-8.013515,"altitud":454.5},{"latitud":42.913944,"longitud":-8.014667,"altitud":455.7},{"latitud":42.91399,"longitud":-8.018005,"altitud":456},{"latitud":42.913074,"longitud":-8.020693,"altitud":455.4},{"latitud":42.911853,"longitud":-8.02332,"altitud":429.8},{"latitud":42.912022,"longitud":-8.027139,"altitud":416.9},{"latitud":42.912045,"longitud":-8.032162,"altitud":417.6},{"latitud":42.912605,"longitud":-8.036573,"altitud":426.2},{"latitud":42.914164,"longitud":-8.039914,"altitud":426},{"latitud":42.916283,"longitud":-8.043173,"altitud":426.1},{"latitud":42.916585,"longitud":-8.04735,"altitud":449.8},{"latitud":42.917659,"longitud":-8.051526,"altitud":459.1},{"latitud":42.915745,"longitud":-8.055529,"altitud":459.4},{"latitud":42.915518,"longitud":-8.059656,"altitud":458.2},{"latitud":42.917062,"longitud":-8.064263,"altitud":422.3},{"latitud":42.915905,"longitud":-8.069193,"altitud":422.6},{"latitud":42.915528,"longitud":-8.073437,"altitud":418.9},{"latitud":42.916174,"longitud":-8.077791,"altitud":399.1},{"latitud":42.91832,"longitud":-8.080884,"altitud":373},{"latitud":42.918034,"longitud":-8.084449,"altitud":348.8},{"latitud":42.918604,"longitud":-8.089051,"altitud":344.9},{"latitud":42.919533,"longitud":-8.090304,"altitud":368.6},{"latitud":42.920038,"longitud":-8.091656,"altitud":385.1},{"latitud":42.920487,"longitud":-8.092397,"altitud":396.4},{"latitud":42.921258,"longitud":-8.092982,"altitud":402.6},{"latitud":42.923643,"longitud":-8.094495,"altitud":408.1},{"latitud":42.924557,"longitud":-8.098172,"altitud":412.9},{"latitud":42.924801,"longitud":-8.102211,"altitud":403},{"latitud":42.926981,"longitud":-8.105458,"altitud":384.6},{"latitud":42.927742,"longitud":-8.108124,"altitud":394},{"latitud":42.928075,"longitud":-8.110963,"altitud":409.7},{"latitud":42.927742,"longitud":-8.113043,"altitud":433.3},{"latitud":42.928761,"longitud":-8.114438,"altitud":419.8},{"latitud":42.929536,"longitud":-8.119287,"altitud":385.9},{"latitud":42.930116,"longitud":-8.124207,"altitud":362},{"latitud":42.930946,"longitud":-8.128888,"altitud":314.5},{"latitud":42.930893,"longitud":-8.130115,"altitud":308.3},{"latitud":42.930502,"longitud":-8.132163,"altitud":311.9},{"latitud":42.930628,"longitud":-8.135116,"altitud":338.5},{"latitud":42.929174,"longitud":-8.136003,"altitud":337},{"latitud":42.930129,"longitud":-8.136168,"altitud":350.1},{"latitud":42.930897,"longitud":-8.139126,"altitud":363.9},{"latitud":42.930192,"longitud":-8.141229,"altitud":373.7},{"latitud":42.929933,"longitud":-8.144888,"altitud":383.9},{"latitud":42.929999,"longitud":-8.149839,"altitud":387},{"latitud":42.929219,"longitud":-8.154833,"altitud":393.5},{"latitud":42.927553,"longitud":-8.159359,"altitud":391.1},{"latitud":42.926192,"longitud":-8.163619,"altitud":385.5},{"latitud":42.926803,"longitud":-8.167038,"altitud":364.7},{"latitud":42.926934,"longitud":-8.168832,"altitud":347.5},{"latitud":42.927041,"longitud":-8.170778,"altitud":336.8},{"latitud":42.927265,"longitud":-8.173898,"altitud":354.1},{"latitud":42.926113,"longitud":-8.175058,"altitud":351.3},{"latitud":42.925546,"longitud":-8.179824,"altitud":321.4},{"latitud":42.924302,"longitud":-8.183334,"altitud":325.7},{"latitud":42.923379,"longitud":-8.184936,"altitud":337.2},{"latitud":42.922762,"longitud":-8.187328,"altitud":345.9},{"latitud":42.923454,"longitud":-8.188804,"altitud":365},{"latitud":42.925633,"longitud":-8.189775,"altitud":370.2},{"latitud":42.926271,"longitud":-8.193373,"altitud":382.8},{"latitud":42.926634,"longitud":-8.195499,"altitud":387.7},{"latitud":42.927102,"longitud":-8.199335,"altitud":357.9},{"latitud":42.927733,"longitud":-8.202772,"altitud":369.1},{"latitud":42.927474,"longitud":-8.205125,"altitud":383.8},{"latitud":42.927603,"longitud":-8.206754,"altitud":390.6},{"latitud":42.92789,"longitud":-8.208558,"altitud":396.5},{"latitud":42.928716,"longitud":-8.211896,"altitud":398.7},{"latitud":42.927705,"longitud":-8.216501,"altitud":398},{"latitud":42.926105,"longitud":-8.221286,"altitud":383.3},{"latitud":42.925522,"longitud":-8.224019,"altitud":389.7},{"latitud":42.924029,"longitud":-8.226958,"altitud":384.5},{"latitud":42.92264,"longitud":-8.229609,"altitud":396.4},{"latitud":42.921709,"longitud":-8.232146,"altitud":389},{"latitud":42.920397,"longitud":-8.235829,"altitud":386.4},{"latitud":42.91859,"longitud":-8.24005,"altitud":362.1},{"latitud":42.918023,"longitud":-8.243822,"altitud":337.7},{"latitud":42.918188,"longitud":-8.247799,"altitud":347.8},{"latitud":42.918818,"longitud":-8.250965,"altitud":359.8},{"latitud":42.919656,"longitud":-8.252786,"altitud":370.1},{"latitud":42.92143,"longitud":-8.25489,"altitud":380.2},{"latitud":42.922355,"longitud":-8.257664,"altitud":377.5},{"latitud":42.922373,"longitud":-8.260344,"altitud":375.5},{"latitud":42.922891,"longitud":-8.262716,"altitud":365},{"latitud":42.923672,"longitud":-8.267436,"altitud":369.8},{"latitud":42.925024,"longitud":-8.269968,"altitud":374.3},{"latitud":42.925881,"longitud":-8.274056,"altitud":370.9},{"latitud":42.926256,"longitud":-8.278137,"altitud":363.8},{"latitud":42.925655,"longitud":-8.282673,"altitud":367.4},{"latitud":42.925502,"longitud":-8.284662,"altitud":377.5},{"latitud":42.925211,"longitud":-8.286994,"altitud":385.6},{"latitud":42.924519,"longitud":-8.28916,"altitud":385.9},{"latitud":42.923858,"longitud":-8.290602,"altitud":388.6},{"latitud":42.923161,"longitud":-8.291834,"altitud":394},{"latitud":42.922691,"longitud":-8.293064,"altitud":399},{"latitud":42.921977,"longitud":-8.294731,"altitud":400.8},{"latitud":42.920313,"longitud":-8.297783,"altitud":384},{"latitud":42.919247,"longitud":-8.300139,"altitud":374.2},{"latitud":42.919072,"longitud":-8.301873,"altitud":377.8},{"latitud":42.919169,"longitud":-8.304463,"altitud":380.8},{"latitud":42.91898,"longitud":-8.306144,"altitud":371.7},{"latitud":42.918349,"longitud":-8.309376,"altitud":369.7},{"latitud":42.917463,"longitud":-8.310925,"altitud":372.3},{"latitud":42.917255,"longitud":-8.31253,"altitud":376.9},{"latitud":42.917116,"longitud":-8.314268,"altitud":379.6},{"latitud":42.916625,"longitud":-8.316598,"altitud":383.8},{"latitud":42.916412,"longitud":-8.317949,"altitud":387.9},{"latitud":42.916023,"longitud":-8.319176,"altitud":393.1},{"latitud":42.915396,"longitud":-8.321357,"altitud":401},{"latitud":42.915624,"longitud":-8.323611,"altitud":406.6},{"latitud":42.916359,"longitud":-8.324533,"altitud":407},{"latitud":42.916508,"longitud":-8.326154,"altitud":401.8},{"latitud":42.917,"longitud":-8.328499,"altitud":387.2},{"latitud":42.917742,"longitud":-8.33283,"altitud":368.4},{"latitud":42.918193,"longitud":-8.334916,"altitud":362.2},{"latitud":42.918353,"longitud":-8.336458,"altitud":356.2},{"latitud":42.91807,"longitud":-8.340089,"altitud":343.6},{"latitud":42.916536,"longitud":-8.343296,"altitud":325.6},{"latitud":42.915758,"longitud":-8.345756,"altitud":308.5},{"latitud":42.914323,"longitud":-8.349093,"altitud":293},{"latitud":42.914786,"longitud":-8.350165,"altitud":282.4},{"latitud":42.914684,"longitud":-8.350148,"altitud":282.3},{"latitud":42.914019,"longitud":-8.351844,"altitud":277.8},{"latitud":42.912449,"longitud":-8.355518,"altitud":266},{"latitud":42.911592,"longitud":-8.358296,"altitud":266.5},{"latitud":42.910347,"longitud":-8.360515,"altitud":274.7},{"latitud":42.90986,"longitud":-8.361902,"altitud":282.5},{"latitud":42.909089,"longitud":-8.3635,"altitud":290.5},{"latitud":42.908235,"longitud":-8.363296,"altitud":294.5},{"latitud":42.90796,"longitud":-8.363514,"altitud":294.8},{"latitud":42.907781,"longitud":-8.364864,"altitud":291.8},{"latitud":42.90799,"longitud":-8.366672,"altitud":292.3},{"latitud":42.907518,"longitud":-8.367662,"altitud":290.8},{"latitud":42.906337,"longitud":-8.37059,"altitud":280.1},{"latitud":42.905796,"longitud":-8.373699,"altitud":274.5},{"latitud":42.904545,"longitud":-8.37545,"altitud":278.9},{"latitud":42.903777,"longitud":-8.37715,"altitud":282.8},{"latitud":42.903719,"longitud":-8.380941,"altitud":288.7},{"latitud":42.903714,"longitud":-8.382227,"altitud":287.7},{"latitud":42.904142,"longitud":-8.383777,"altitud":289.5},{"latitud":42.904774,"longitud":-8.386176,"altitud":292.4},{"latitud":42.903314,"longitud":-8.387461,"altitud":275.1},{"latitud":42.905024,"longitud":-8.391366,"altitud":253},{"latitud":42.905919,"longitud":-8.394466,"altitud":255},{"latitud":42.90562,"longitud":-8.396243,"altitud":261.9},{"latitud":42.905524,"longitud":-8.397865,"altitud":276.3},{"latitud":42.906372,"longitud":-8.399716,"altitud":291.7},{"latitud":42.906015,"longitud":-8.402483,"altitud":300.6},{"latitud":42.905772,"longitud":-8.40393,"altitud":310.7},{"latitud":42.905852,"longitud":-8.406966,"altitud":329.3},{"latitud":42.906145,"longitud":-8.40971,"altitud":344.8},{"latitud":42.907799,"longitud":-8.412738,"altitud":363.8},{"latitud":42.908964,"longitud":-8.414834,"altitud":367.5},{"latitud":42.910099,"longitud":-8.414535,"altitud":368},{"latitud":42.913616,"longitud":-8.414436,"altitud":363.7},{"latitud":42.913677,"longitud":-8.419468,"altitud":345.3},{"latitud":42.912483,"longitud":-8.423476,"altitud":327.7},{"latitud":42.911189,"longitud":-8.424161,"altitud":341.9},{"latitud":42.910213,"longitud":-8.424197,"altitud":342.2},{"latitud":42.908989,"longitud":-8.423703,"altitud":341.1},{"latitud":42.908892,"longitud":-8.425972,"altitud":332.7},{"latitud":42.908019,"longitud":-8.427203,"altitud":344.9},{"latitud":42.906986,"longitud":-8.428202,"altitud":351},{"latitud":42.906207,"longitud":-8.429764,"altitud":340.5},{"latitud":42.904354,"longitud":-8.433518,"altitud":330.6},{"latitud":42.902567,"longitud":-8.437344,"altitud":320.5},{"latitud":42.901647,"longitud":-8.44137,"altitud":314.7},{"latitud":42.900649,"longitud":-8.445175,"altitud":304.2},{"latitud":42.899499,"longitud":-8.445708,"altitud":301.4},{"latitud":42.89825,"longitud":-8.444141,"altitud":296.3},{"latitud":42.89771,"longitud":-8.445732,"altitud":299.9},{"latitud":42.896765,"longitud":-8.447581,"altitud":323.9},{"latitud":42.895928,"longitud":-8.447655,"altitud":324.7},{"latitud":42.894248,"longitud":-8.447432,"altitud":338.3},{"latitud":42.893018,"longitud":-8.448524,"altitud":350.8},{"latitud":42.892161,"longitud":-8.449735,"altitud":350.6},{"latitud":42.891451,"longitud":-8.451135,"altitud":353.7},{"latitud":42.890939,"longitud":-8.453296,"altitud":362.7},{"latitud":42.890907,"longitud":-8.454105,"altitud":366.2},{"latitud":42.890177,"longitud":-8.456014,"altitud":370.7},{"latitud":42.890124,"longitud":-8.457429,"altitud":374.1},{"latitud":42.890539,"longitud":-8.460051,"altitud":382.9},{"latitud":42.890406,"longitud":-8.461709,"altitud":383},{"latitud":42.890847,"longitud":-8.466445,"altitud":385.2},{"latitud":42.89116,"longitud":-8.468806,"altitud":389.3},{"latitud":42.891409,"longitud":-8.470465,"altitud":389.3},{"latitud":42.892108,"longitud":-8.475171,"altitud":381.3},{"latitud":42.89149,"longitud":-8.476338,"altitud":381.4},{"latitud":42.890539,"longitud":-8.477842,"altitud":376.8},{"latitud":42.890643,"longitud":-8.48027,"altitud":377.4},{"latitud":42.890647,"longitud":-8.481797,"altitud":384.6},{"latitud":42.890685,"longitud":-8.483571,"altitud":383.2},{"latitud":42.891323,"longitud":-8.487561,"altitud":362.6},{"latitud":42.890907,"longitud":-8.490864,"altitud":366},{"latitud":42.890064,"longitud":-8.492833,"altitud":369},{"latitud":42.889352,"longitud":-8.494924,"altitud":371.6},{"latitud":42.888335,"longitud":-8.497613,"altitud":353.5}]"');
#https://dev.mysql.com/doc/refman/8.0/en/json.html
SELECT id, nombre, nickname, email, passwd, salt,  imagen, fecha_nacimiento, email_is_admin('a@a.com') FROM usuario WHERE email = 'a@a.com';
UPDATE usuario SET nombre='fff' WHERE id = 14;
CALL completar_organizador (14, 'abel', 'abelin', '2022-02-16', 'jeje', '687526414', 'nombre');

DELIMITER $$
CREATE FUNCTION comprobar_registro(p_id INT)
RETURNS BOOLEAN
BEGIN
     DECLARE v_estado BOOLEAN;
	 SET v_estado = (SELECT * FROM completados WHERE id_usuario = p_id);
     RETURN v_estado;
END;
$$
DELIMITER ; 

SELECT comprobar_registro(29);

INSERT INTO usuario (nombre) VALUES ('aa');
INSERT INTO usuario_organizador (id_usuario) VALUES(last_insert_id());
DELIMITER $$
CREATE PROCEDURE set_ubicacion (p_ubicacion VARCHAR(64), p_id_evento INT)
BEGIN 
	DECLARE v_isset BOOLEAN;
    
    SET v_isset = (SELECT isset_ubicacion(p_id_evento));
    
    IF NOT v_isset THEN
		UPDATE evento SET ubicacion = p_ubicacion WHERE id = p_id_evento;
    END IF;
END
$$
DELIMITER ;